
# $Id$

@SET_MAKE@

# Set makefile variables, some with values supplid by configure 
# DEFS gets the `-D' defines that describe what a particular system has
# or doesn't have.

prefix = @prefix@
exec_prefix = $(prefix)
bindir = $(exec_prefix)/cgi-bin
libdir = $(exec_prefix)/lib
includedir = $(prefix)/include
etcdir = $(prefix)/etc
TAR = @TAR@
AR = ar
RANLIB = @RANLIB@
INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@
INSTALL_PROGRAM = @INSTALL_PROGRAM@

CDFSRCS:=CDFArray.cc CDFFloat32.cc CDFFloat64.cc CDFInt32.cc CDFUInt32.cc \
	CDFByte.cc CDFStr.cc CDFUnused.cc \
	CDFreadAttributes.cc CDFreadDescriptors.cc \
	CDFutilities.cc CDFRequestHandler.cc
CDFOBJS:=CDFArray.o CDFFloat32.o CDFFloat64.o CDFInt32.o CDFUInt32.o \
	CDFByte.o CDFStr.o CDFUnused.o \
	CDFreadAttributes.o CDFreadDescriptors.o \
	CDFutilities.o CDFRequestHandler.o

SSRCS:=cdf_handler.cc
SRVOBJS:=cdf_handler.o

HANDLER:=cdf_handler
MODOBJS:=cdf_module.o

LIB:=libcdf-handler.a
INCS:=-I. @INCS@
DEFS:=@DEFS@
CXXFLAGS:=@CXXFLAGS@ -Wall -Wno-deprecated
CPPFLAGS:=$(CXXFLAGS) $(DEFS) $(INCS)

LIBS:=-L. -lcdf-handler @LIBS@
MODS:=@MODS@

SHELL = /bin/sh
version = @VERSION@
basedir = cdf-handler
dir = $(basedir)-$(version)
host = @host@

COMPONENT_NAME = DODS CDF Server

# names of key programs

LN_S = @LN_S@
CC = @CC@
CXX = @CXX@
TAGS = etags
VPATH = .

# Matlab client can be suppressed by a switch to configure.
all: $(LIB) handler

lib: $(LIB)

handler: $(HANDLER)

$(LIB): $(LIBOBJS) $(CDFOBJS) 
	$(AR) -cru $@ $(LIBOBJS) $(CDFOBJS) 
	$(RANLIB) $@

$(HANDLER) : $(LIB) $(MODOBJS) $(HANDLER).o $(MODS)
	g++ -o $(HANDLER) $(HANDLER).o $(MODS) $(MODOBJS) $(LIB) $(LIBS)

# Standard targets with some customization for das-test and dds-test

configure: configure.in $(DODS_ROOT)/etc/aclocal.m4
	autoconf --include=$(DODS_ROOT)/etc

Makefile: Makefile.in
	if [ -x ./config.status ]; \
	then \
	    ${SHELL} ./config.status; \
	else \
	    ./configure; \
	fi

check:
	echo "No tests at this time"

install: $(LIB) $(PROG) install-mods install-progs
	-mkdir -p $(libdir)
	$(INSTALL_DATA) $(LIB) $(libdir)
	$(RANLIB) $(libdir)/$(LIB)

install-mods:
	-mkdir -p $(libdir)
	for h in $(MODOBJS); \
	    do $(INSTALL_DATA) $$h $(libdir); done

install-progs: $(HANDLER)
	-mkdir -p $(bindir)
	$(INSTALL_PROGRAM) -s $(HANDLER) $(bindir)

clean:	
	-rm -f *.o *.sum *.log *~ core
	-rm -f $(PROG) $(LIB)

distclean:
	-rm -f *.o *.sum *.log *~ core
	-rm -f $(PROG) $(LIB)
	-rm -f config.status config.log config.cache
	-rm -f site.exp config_cdf.h

.PHONY: depend
depend: 
	@depend@ -m Makefile.in -- $(CPPFLAGS) -- $(SSRCS) $(CDFSRCS)
	$(MAKE) $(MFLAGS) Makefile

.PHONY: tar
tar:
	-rm -f config.cache config.log config.status
	cd $(DODS_ROOT)/.. && \
	$(TAR) --exclude 'old' --exclude '.#*' --exclude 'CVS' \
	    --exclude '.snprj*' --exclude '.flc*' --exclude 'Makefile' \
	    --gzip --create --dereference --file DODS-$(dir).tar.gz \
	    DODS/src/$(dir)

# Creates tar files for binary distributions.
#
.PHONY: binary-tar
binary-tar:
	cd $(DODS_ROOT).. && ( \
	$(TAR) --gzip --create --dereference \
            --file DODS-cdf-library-$(version)-$(host).tar.gz \
            DODS/NEWS \
            DODS/docs/README DODS/docs/README-cdf-library \
            DODS/lib/libcdf-handler.a ; \
        $(TAR) --gzip --create --dereference \
            --file DODS-cdf-server-$(version)-$(host).tar.gz \
            DODS/NEWS \
            DODS/docs/README DODS/docs/README-cdf-server \
            DODS/etc/cdf_handler ; \
        $(TAR) --gzip --create --dereference \
            --file DODS-cdf-client-$(version)-$(host).tar.gz \
            DODS/NEWS \
            DODS/docs/README DODS/docs/README-cdf-client )

.PHONY: update-version
update-version: check-version
	@echo "Version is: `cat version.h`"
	if test ! -d ../$(dir); then mv ../$(basedir)* ../$(dir); fi
	if test ! -f $(DODS_ROOT)VERSION; then touch $(DODS_ROOT)VERSION; fi
	$(etcdir)/update-manifest.pl "$(COMPONENT_NAME)" $(version) \
		< $(DODS_ROOT)VERSION > tmp.dods.manifest
	mv tmp.dods.manifest $(DODS_ROOT)VERSION

# Compare the version encoded in this Makefile (set by configure) with the
# version in version.h. The version make variable is set up near the top of
# the Makefile.
.PHONY: check-version
check-version:
	@echo "Checking for version.h and Makefile version match-up"
	@if [ "$(version)" != "`cat version.h`" ]; \
	then \
		echo "You must manually re-run configure!"; \
		exit 1; \
	else \
		echo "Yes, they match."; \
	fi

.PHONY: tags
tags:
	$(TAGS) $(TAGS_FLAGS) *.cc *.h

.SUFFIXES:      .o .cc

.cc.o:
	$(CXX) -c $(CPPFLAGS) -o $@ $<

# DO NOT DELETE; depend depends on this line.
cdf_handler.o: cdf_handler.cc \
  /project/cedar/src/pwest/opendap-g/include/opendap-g/DODSCgi.h \
  /project/cedar/src/pwest/opendap-g/include/opendap-g/DODS.h \
  /project/cedar/src/pwest/opendap-g/include/opendap-g/DODSDataHandlerInterface.h \
  /project/cedar/src/pwest/opendap-g/include/opendap-g/DODSContainer.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/DODSFilter.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/DAS.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Pix.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/IteratorAdapter.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/AttrTable.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Error.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/DODSResponseObject.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/DDS.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/BaseType.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/InternalErr.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/dods-datatypes.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Constructor.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/BaseTypeFactory.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Clause.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/expr.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/RValue.h \
  /project/cedar/src/pwest/opendap-g/include/opendap-g/DODSGlobalIQ.h \
  /project/cedar/src/pwest/opendap-g/include/opendap-g/DODSException.h \
  config_cdf.h
CDFArray.o: CDFArray.cc CDFArray.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Array.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/dods-limits.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Vector.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/BaseType.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/AttrTable.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Pix.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/IteratorAdapter.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Error.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/InternalErr.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/dods-datatypes.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/DDS.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Constructor.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/BaseTypeFactory.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/DAS.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/DODSResponseObject.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Clause.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/expr.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/RValue.h \
  CDFutilities.h \
  /project/cedar/src/pwest/packages/cdf30-dist/include/cdf.h
CDFFloat32.o: CDFFloat32.cc CDFFloat32.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Float32.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/dods-datatypes.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/BaseType.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/AttrTable.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Pix.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/IteratorAdapter.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Error.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/InternalErr.h
CDFFloat64.o: CDFFloat64.cc CDFFloat64.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Float64.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/dods-datatypes.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/BaseType.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/AttrTable.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Pix.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/IteratorAdapter.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Error.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/InternalErr.h
CDFInt32.o: CDFInt32.cc CDFInt32.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Int32.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/dods-datatypes.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/BaseType.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/AttrTable.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Pix.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/IteratorAdapter.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Error.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/InternalErr.h
CDFUInt32.o: CDFUInt32.cc CDFUInt32.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/UInt32.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/dods-datatypes.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/BaseType.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/AttrTable.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Pix.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/IteratorAdapter.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Error.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/InternalErr.h
CDFByte.o: CDFByte.cc CDFByte.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Byte.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/dods-datatypes.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/BaseType.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/AttrTable.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Pix.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/IteratorAdapter.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Error.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/InternalErr.h
CDFStr.o: CDFStr.cc CDFStr.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Str.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/dods-limits.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/BaseType.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/AttrTable.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Pix.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/IteratorAdapter.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Error.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/InternalErr.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/dods-datatypes.h
CDFUnused.o: CDFUnused.cc CDFUnused.h
CDFreadAttributes.o: CDFreadAttributes.cc CDFreadAttributes.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/DAS.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Pix.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/IteratorAdapter.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/AttrTable.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Error.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/DODSResponseObject.h \
  CDFutilities.h \
  /project/cedar/src/pwest/packages/cdf30-dist/include/cdf.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/BaseType.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/InternalErr.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/dods-datatypes.h
CDFreadDescriptors.o: CDFreadDescriptors.cc CDFreadDescriptors.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/DDS.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Pix.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/IteratorAdapter.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/BaseType.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/AttrTable.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Error.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/InternalErr.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/dods-datatypes.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Constructor.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/BaseTypeFactory.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/DAS.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/DODSResponseObject.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Clause.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/expr.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/RValue.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/cgi_util.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/ObjectType.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/EncodingType.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/DODSFilter.h \
  CDFutilities.h \
  /project/cedar/src/pwest/packages/cdf30-dist/include/cdf.h CDFArray.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Array.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/dods-limits.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Vector.h
CDFutilities.o: CDFutilities.cc CDFutilities.h \
  /project/cedar/src/pwest/packages/cdf30-dist/include/cdf.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/BaseType.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/AttrTable.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Pix.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/IteratorAdapter.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Error.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/InternalErr.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/dods-datatypes.h \
  CDFByte.h /project/cedar/src/pwest/opendap-g/include/libdap/Byte.h \
  CDFInt32.h /project/cedar/src/pwest/opendap-g/include/libdap/Int32.h \
  CDFUInt32.h /project/cedar/src/pwest/opendap-g/include/libdap/UInt32.h \
  CDFFloat32.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Float32.h \
  CDFFloat64.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Float64.h CDFStr.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Str.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/dods-limits.h
CDFRequestHandler.o: CDFRequestHandler.cc CDFRequestHandler.h \
  /project/cedar/src/pwest/opendap-g/include/opendap-g/DODSRequestHandler.h \
  /project/cedar/src/pwest/opendap-g/include/opendap-g/DODSDataHandlerInterface.h \
  /project/cedar/src/pwest/opendap-g/include/opendap-g/DODSContainer.h \
  /project/cedar/src/pwest/opendap-g/include/opendap-g/DODSResponseHandler.h \
  /project/cedar/src/pwest/opendap-g/include/opendap-g/DODSTransmitter.h \
  /project/cedar/src/pwest/opendap-g/include/opendap-g/DODSResponseNames.h \
  CDFreadAttributes.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/DAS.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Pix.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/IteratorAdapter.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/AttrTable.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Error.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/DODSResponseObject.h \
  CDFreadDescriptors.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/DDS.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/BaseType.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/InternalErr.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/dods-datatypes.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Constructor.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/BaseTypeFactory.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/Clause.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/expr.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/RValue.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/cgi_util.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/ObjectType.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/EncodingType.h \
  /project/cedar/src/pwest/opendap-g/include/libdap/DODSFilter.h \
  /project/cedar/src/pwest/opendap-g/include/opendap-g/DODSConstraintFuncs.h \
  /project/cedar/src/pwest/opendap-g/include/opendap-g/DODSInfo.h \
  /project/cedar/src/pwest/opendap-g/include/opendap-g/TheDODSKeys.h \
  /project/cedar/src/pwest/opendap-g/include/opendap-g/DODSKeys.h \
  /project/cedar/src/pwest/opendap-g/include/opendap-g/DODSResponseException.h \
  /project/cedar/src/pwest/opendap-g/include/opendap-g/DODSBasicException.h \
  /project/cedar/src/pwest/opendap-g/include/opendap-g/DODSException.h \
  cdf_version.h config_cdf.h
